<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.pointhome.www.partner.dao.face.PartnerDao">


	<insert id="insertPartner" parameterType="Partner">
		insert into Partner_tb	(
		partner_no,
		partner_name,
		partner_pw,
		partner_nick,
		partner_email,
		partner_phone,
		partner_shopname,
		partner_type,		
		partner_bank,
		partner_account,
		partner_gender,
		partner_birthyear,
		partner_birthmonth,
		partner_birthday,
		partner_postcode,
		partner_address,
		partner_detailaddress,
		partner_extraaddress)
		
		values(
		partner_tb_seq.nextval,	
		#{partnerName},
		#{partnerPw},
		#{partnerNick},
		#{partnerEmail},
		#{partnerPhone},
		#{partnerShopname},
		#{partnerType},
		#{partnerBank},
		#{partnerAccount},
		#{partnerGender},
		#{partnerBirthyear},
		#{partnerBirthmonth},
		#{partnerBirthday},
		#{partnerPostcode},
		#{partnerAddress},
		#{partnerDetailaddress},
		#{partnerExtraaddress}		)
	</insert>

	<!-- 중복검사 -->	
	<select id="selectCntByEmailPhone" resultType="int" parameterType="Partner">
		select count(*) from partner_tb
		where partner_email = #{partnerEmail} or partner_phone = #{partnerPhone}
	
	</select>
	
	<select id="selectCntByPartnerEmailPw" resultType="int" parameterType="Partner">
		select count(*) from partner_tb
		where partner_email = #{partnerEmail} 
		and partner_pw = #{partnerPw}
	</select> 

	<select id="selectByPartnerEmailPw" resultType="Partner" parameterType="Partner">
	
		select partner_no from partner_tb
		where partner_email=#{partnerEmail} and partner_pw =#{partnerPw}
	
	</select>
	
	
	<select id="selectAll" resultType="Partner" parameterType="Paging">
		select * from (
			select rownum rnum , B.*  from ( 
				select * from partner_tb
				order by partner_no desc 
			) B 
		)partner_tb
		where rnum between #{startNo} and #{endNo}
	</select>
	
	<select id="selectCntAll" resultType="int" >
			select count(*) from partner_tb
		
	</select>
	
	<select id="selectCntTypeAll" resultType="int" parameterType="map">
		<if test="partnerType == 'c'.toString() ">
			select count(*) from partner_tb	where partner_type = 'c'
		</if>
		<if test="partnerType == 's'.toString()">
			select count(*) from partner_tb where partner_type = 's'
		</if>
		<if test="partnerType == 't'.toString()">
			select count(*) from partner_tb where partner_type = 't'
		</if>
	</select>
	
	<select id="selectTypeListAll" resultType="Partner" parameterType="map">
		select * from (
			select rownum rnum , B.*  from ( 
				select * from partner_tb where partner_type = #{partnerType}
				order by partner_no desc 
			) B 
		)partner_tb
		where rnum between #{paging.startNo} and #{paging.endNo}
	</select>
	

	<select id="selectAllPartnerNotice" resultType="PartnerNotice" parameterType="Paging">
		select * from (
		SELECT rownum rnum, A.* FROM (
			SELECT *
			FROM partner_notice
			ORDER BY partner_notice_no DESC 
		) A
	)
		where rnum between #{startNo} and #{endNo} 
	</select>
	
	
	
	<insert id="insertNotice" parameterType="PartnerNotice">

		<selectKey order="BEFORE" resultType="int" keyProperty="partnerNoticeNo">
			SELECT partner_notice_seq.nextval FROM dual
		</selectKey>
		
		insert into partner_notice(
		partner_notice_no,
		partner_notice_title,
		partner_notice_content,
		partner_no,
		div)

		values(
		#{partnerNoticeNo},
		#{partnerNoticeTitle},
		#{partnerNoticeContent},
		#{partnerNo},
		#{div})


	</insert>

	<insert id="insertFile" parameterType="PartnerNoticeFile">
		insert into partner_notice_file
		(
		partner_notice_file_no,
		partner_notice_file_origin,
		partner_notice_file_stored,
		partner_notice_no)
		
		values(
		partner_fileno_seq.nextval,
		#{partnerNoticeFileOrigin},
		#{partnerNoticeFileStored},
		#{partnerNoticeNo})

	</insert>
	
	<select id="selectPartnerNo" parameterType="Partner" resultType="int">
		select partner_no 
		from partner_tb
		where partner_email = #{partnerEmail} 
		and partner_pw = #{partnerPw} 
	
	</select>
	
	<select id="selectNoticeCntAll"  resultType="int">
		select count(*) from partner_notice 
	</select>
	
	<select id="selectPartnerInfo" resultType="Partner" parameterType="int">
	
		select *  from partner_tb
		where partner_no = #{partnerNo}
	
	</select>
	
	<select id="viewNotice" resultType="PartnerNotice" parameterType="int">
		select * from partner_notice
		where partner_notice_no = #{partnerNoticeNo}
	
	</select>
	
	<select id="getMultiFiles" parameterType="int" resultType="PartnerNoticeFile">
		select * from partner_notice_file
		where partner_notice_no = #{partnerNoticeNo}
	</select>
	
	<select id="selectByPartnerNo" resultType="Partner" parameterType="int">
		select * from partner_tb
		where partner_no = #{partnerNo}
	
	</select>

</mapper>

