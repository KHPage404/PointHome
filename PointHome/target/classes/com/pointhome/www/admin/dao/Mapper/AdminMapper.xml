<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pointhome.www.admin.dao.face.AdminDao">

	<select id="selectAdminIdPw" parameterType="Admin"
		resultType="int">
		SELECT count(*) FROM ADMIN_TB
		WHERE 1=1
		AND admin_id = #{adminId}
		AND admin_pw = #{adminPw}
	</select>

	<select id="selectAllUser" resultType="User">
		SELECT *
		FROM USER_TB
		order
		by user_no
	</select>

	<select id="selectByAdminEmailPw" parameterType="Admin"
		resultType="Admin">
		select * from admin_tb
		where admin_id = #{adminId}
		and admin_pw = #{adminPw}

	</select>



 	<select id="selectAllSearch" resultType="Map" parameterType="Map">
      select * from (
         select rownum rnum, A.* from (
         SELECT *
         FROM ADMIN_NOTICE
         <if test='type != "a"'>
            <where>
               <if test='type == "p"'>
                  AND div = 'p'
               </if>
               <if test='type == "u"'>
                  AND div = 'u'
               </if>
            </where>
         </if>
         <if test='type == "a"'>
            <where>
               <if test='filter == "p"'>
                  AND div = 'p'
               </if>
               <if test='filter == "u"'>
                  AND div = 'u'
               </if>
            </where>
         </if>
         ORDER BY notice_no DESC
         ) A
      ) where rnum between #{paging.startNo} and #{paging.endNo}
   </select>
	


	<select id="selectUserInfo" parameterType="int" resultType="map">
		select u.*, (select count(*)
		from freeboard f
		where f.user_no =
		#{userNo}) as FREEBOARD
		,(select count(*)
		from freeboard_comment fc
		where fc.user_no = #{userNo}) as FREEBOARDCOMMENT
		FROM user_tb u
		WHERE
		u.user_no = #{userNo}
	</select>

	<select id="selectUserPost" parameterType="int"
		resultType="FreeBoard">
		SELECT FREEBOARD_NO, FREEBOARD_TITLE,
		FREEBOARD_HIT,FREEBOARD_DATE
		FROM freeboard
		where user_no = #{userno}
	</select>

	<select id="selectUserCmt" parameterType="int"
		resultType="FreeBoardComment">
		select COMM_NO, COMM_CONTENT, COMM_DATE, FREEBOARD_NO
		FROM
		FREEBOARD_COMMENT
		WHERE user_no = #{userno}
		ORDER BY FREEBOARD_NO desc,
		comm_no desc
	</select>


	<insert id="insertNotice" parameterType="AdminNotice">

		<selectKey order="BEFORE" resultType="int"
			keyProperty="noticeNo">
			SELECT notice_no_seq.nextval FROM dual
		</selectKey>

		insert into Admin_notice(
		notice_no,
		notice_title,
		notice_content,
		admin_no,
		div)

		values(
		#{noticeNo},
		#{noticeTitle},
		#{noticeContent},
		#{adminNo},
		#{div})


	</insert>

	<insert id="insertFile" parameterType="AdminNoticeFile">
		insert into
		admin_notice_file
		(
		admin_fileno,
		admin_file_origin,
		admin_file_stored,
		notice_no)

		values(
		admin_fileno_seq.nextval,
		#{adminFileOrigin},
		#{adminFileStored},
		#{noticeNo})

	</insert>

	<select id="selectNoticeCntAll" resultType="int">
		  select count(*) from (
         select rownum rnum, A.* from (
         SELECT *
         FROM ADMIN_NOTICE
         <if test='type != "a"'>
            <where>
               <if test='type == "p"'>
                  AND div = 'p'
               </if>
               <if test='type == "u"'>
                  AND div = 'u'
               </if>
            </where>
         </if>
         <if test='type == "a"'>
            <where>
               <if test='filter == "p"'>
                  AND div = 'p'
               </if>
               <if test='filter == "u"'>
                  AND div = 'u'
               </if>
            </where>
         </if>
         ORDER BY notice_no DESC
         ) A
      )
		
	</select>

	<select id="viewNotice" resultType="AdminNotice"
		parameterType="int">
		select * from admin_notice
		where notice_no = #{noticeNo}
	</select>

	<select id="getMultiFiles" parameterType="int"
		resultType="AdminNoticeFile">
		select * from admin_notice_file
		where notice_no = #{noticeNo}
	</select>

	<select id="selectAllAdminNo" resultType="Admin"
		parameterType="int">
		SELECT * FROM admin_tb
		WHERE admin_no = #{adminNo}
	</select>

	<delete id="deleteFile" parameterType="int">
		delete admin_notice_file
		where notice_no = #{noticeNo}
	</delete>

	<delete id="deleteNotice" parameterType="AdminNotice">
		delete admin_notice
		where
		notice_no = #{noticeNo}
	</delete>

	<select id="selectNoticebyNoticeNo" resultType="AdminNotice"
		parameterType="int">
		select * from admin_notice
		where notice_no = #{noticeNo}

	</select>

	<select id="selectNoticeFilebyNoticeNo"
		resultType="AdminNoticeFile" parameterType="int">
		select * from admin_notice_file
		where notice_no =
		#{noticeNo}
	</select>

	<update id="update" parameterType="AdminNotice">
		update admin_notice set
		notice_title = #{noticeTitle},
		notice_content = #{noticeContent}
		where notice_no = #{noticeNo}
	</update>

	<select id="selectFile" parameterType="int"
		resultType="AdminNoticeFile">
		select * from admin_notice_file
		where admin_fileno =
		#{adminFileNo}
	</select>
	
	<delete id="deleteUserByUserNo" parameterType="int">
		delete from user_tb
		where user_no = #{userNo}
	</delete>


</mapper>